# Git常用命令及其原理

## 1、Git概述

Git 是一个开源的 **分布式版本控制系统**，其分布式特性主要体现在，对于每次克隆操作，都对代码仓库进行完整备份，即每个开发者本地都保存了整个项目开发迭代的完整备份，有效避免集中式架构下中心服务器故障可能带来的数据丢失。

Git主要分为工作区、暂存区和版本库，具体如下：

+ 工作区：即工作目录下直接进行增删改等操作的文件目录；
+ 暂存区：一般存放在 `.git` 目录下的 `index` 文件中，有时也叫作索引，用于存放临时改动，保存即将提交的文件列表信息；
+ 版本库： 工作区有一个隐藏目录 `.git`，这个不算工作区，而是 Git 的版本库，这里保存了我们提交的所有版本的数据。

下图描述了Git工作区、暂存区和版本库之间的关系：

![image-20231009224649593](https://img.zxdmy.com/2022/202310092246081.png)

存储在Git仓库中的内容通常称为Git对象，其有四种类型：

+ 数据对象（blob）
+ 树对象（tree）
+ 提交对象（commit）
+ 标签对象（tag）

#### 数据对象

数据对象是再使用 `git add` 命令，将文件或目录添加至暂存区时产生的，这个过程中，Git 会把文件中要存在的数据，和一个头部信息一起进行`SHA-1散列运算`，将得到的散列值作为文件的路径。

比如将含有内容为 `hello world!` 的 `hello.txt` 文件，添加至暂存区时，得到`SHA-1散列值``bc7774a7b18deb1d7bd0212d34246a9b1260ae17` ，前2个字符用于命名子目录，其余38字符用于命名文件，生成的`数据对象`如下图所示：

![image-20231015221051320](https://img.zxdmy.com/2022/202310152211953.png)

这个散列值路径文件中保存的只是源文件的一种压缩形式。

除了单个文件，将一系列文件（比如`git add <fileName>`、`git add .` 命令）添加至暂存区，每个文件都将生成一个数据对象，如下图所示。

![image-20231015221848766](https://img.zxdmy.com/2022/202310152218838.png)

#### 树对象

数据对象中没有存储任何目录相关的信息。树对象，则解决了文件名保存问题，允许将多个文件组织到一起。通过 `git commit` 命令可以生成树对象。

`git commit` 后，每个文件都设置了文件模式 `mode` ，为`100644`，表示普通文件。

再次对比 `objects` 目录发现，又多了三个文件，如下图所示。

![image-20231015223259434](https://img.zxdmy.com/2022/202310152248361.png)

解析每个文件内容，如下图所示。

![image-20231015223737108](https://img.zxdmy.com/2022/202310152248903.png)

按命名顺序：

+ 第1 个文件：是`commit`提交的对象内容，指明了树对象为`ac86fc51e061e2fc9ac01545ad011ffad3596616`，即第 3 个文件；同时包含本次提交的作者等信息；
+ 第 3 个文件：
    + 第1条记录，表示该树对象指向 `bc7774a7b18deb1d7bd0212d34246a9b1260ae17` 数据对象
    + 第2条记录，表示该树对象指向 `7f6fd15405b2303d4e2269a4d21f3e9c48143df6` 树对象（040000）
+ 第 2 个文件，是第3个文件第2条记录所指向的树对象，其包含 2 个数据对象，分别指向 `3462721fd4da6b3f451e6e720c547d0bbd546db3` 和 `c944ebc28f05731ef588ac6298485ba5e8bf3704`。

#### 提交对象

即前文中，第1个文件的解析，其包含一个`树对象`条目，代表着当前项目快照。从这个树对象，一层层往下找，就能找到所有提交的数据对象，并能够构建完整的项目目录。

## 2、常用命令简介

### 2.1 对象操作命令

初始化工作目录：`git init`

将`a.txt`添加至暂存区：`git add a.txt`

提交暂存区内容：`git commit -m “commit message”`

### 2.2 分支操作命令

创建分支命令：`git branch <branch_name>`

切换分支：`git checkout <branch_name>`

分支合并：`git merge branch`

### 2.3 其他常用命令

将所有未提交的修改（工作区和暂存区）保存至堆栈中：`git stash`

将堆栈中的内容应用到当前目录：`git stash apply`

## 3、常用命令实现原理



参考：

https://blog.csdn.net/qq_38526623/article/details/117950702

https://blog.csdn.net/m0_62083249/article/details/126622251

Git 对象：https://blog.csdn.net/songyunzu/article/details/92023816